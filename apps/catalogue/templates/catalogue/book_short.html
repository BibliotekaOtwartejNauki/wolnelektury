{% load i18n %}
{% load catalogue_tags social_tags %}
{% load thumbnail %}

<div class="{% block box-class %}book-box{% endblock %}">
    <div class="book-box-inner">

        <div class="cover-area">
            {% if book.cover %}
                {% if main_link %}<a href="{{ main_link }}">{% endif %}
                    <img src="
                        {% thumbnail book.cover "139x193" as thumb %}
                            {{ thumb.url }}
                        {% empty %}
                            {{ book.cover.url }}
                        {% endthumbnail %}
                    " alt="Cover" class="cover" />
                {% if main_link %}</a>{% endif %}
            {% endif %}
            {% block cover-area-extra %}{% endblock %}
        </div>

        <div class="book-box-body">

            <div class="star {% if not request.user|likes:book %}un{% endif %}like">
                <div class="if-like" >
                    <a id="social-book-sets-{{ book.slug }}" data-callback='social-book-sets' class='ajaxable' href='{% url "social_book_sets" book.slug %}'>
                        ★
                    </a>
                </div>
                <div class="if-unlike">
                    <form id="social-like-book-{{ book.slug }}" data-callback='social-like-book' method='post' class='ajax-form' action='{% url "social_like_book" book.slug %}'>
                        {% csrf_token %}
                        <button type='submit'>☆</button>
                    </form>
                </div>
            </div>


            <div class="book-box-head">
                <div class="mono author">
                    {% for name, slug in related.tags.author %}
                        <a href="{% tag_url 'author' slug %}">{{ name }}</a>
                        {% if not forloop.last %},{% endif %}
                    {% endfor %}
                    {% for title, slug in related.parents %},
                        <a href="{% url 'book_detail' slug %}">{{ title }}</a>
                    {% endfor %}
                </div>
                <div class="title">
                    {% if main_link %}<a href="{{ main_link }}">{% endif %}
                        {{ book.title }}
                    {% if main_link %}</a>{% endif %}
                </div>
            </div>

            <div class="tags">
                {% spaceless %}

                    {% if related.tags.epoch %}
                        <span> {% trans "Epoch" %}:</span>&nbsp;<span class="book-box-tag">
                            {% for name, slug in related.tags.epoch %}
                                <a href="{% tag_url 'epoch' slug %}">{{ name }}</a>
                                {% if not forloop.last %}<span>,&nbsp;</span>{% endif %}
                            {% endfor %}
                        </span>
                    {% endif %}

                    {% if related.tags.kind %}
                        <span class="mono"> {% trans "Kind" %}:</span>&nbsp;<span class="book-box-tag">
                            {% for name, slug in related.tags.kind %}
                                <a href="{% tag_url 'kind' slug %}">{{ name }}</a>
                                {% if not forloop.last %}<span>,&nbsp;</span>{% endif %}
                            {% endfor %}
                        </span>
                    {% endif %}

                    {% if related.tags.genre %}
                        <span class="mono"> {% trans "Genre" %}:</span>&nbsp;<span class="book-box-tag">
                            {% for name, slug in related.tags.genre %}
                                <a href="{% tag_url 'genre' slug %}">{{ name }}</a>
                                {% if not forloop.last %}<span>,&nbsp;</span>{% endif %}
                            {% endfor %}
                        </span>
                    {% endif %}

                {% endspaceless %}
            </div>
        </div>

        {% shelf_tags book %}

        {% block book-box-extra-info %}{% endblock %}
        {% block box-append %}{% endblock %}
        {% block right-column %}{% endblock %}
        <div class="clearboth"></div>

    </div>
</div>
